# Whisper Audio Transcriber

Готовое решение для транскрибации аудиофайлов с использованием OpenAI Whisper. Преобразует аудио в текст с временными метками сегментов.

## To-Do по интеграции

### 1. Установка зависимостей

```bash
pip install openai-whisper
```

### 2. Копирование функции

Скопировать файл `whisper_transcriber.py` в ваш проект.

### 3. Импорт и использование

```python
from whisper_transcriber import transcribe_audio

result = transcribe_audio("path/to/audio.mp3")
print(result['segments'])
print(result['full_text']['text'])
```

## Функция: `transcribe_audio`

### Описание

Функция для транскрибации аудиофайлов с использованием модели Whisper "base". Возвращает полный текст и сегментированный результат с временными метками.

### Входные данные (Input)

#### Параметр: `audio_path`

**Тип:** `str`  
**Описание:** Путь к аудиофайлу для транскрибации

**Поддерживаемые форматы:**

- MP3
- WAV
- FLAC
- M4A
- OGG
- и другие форматы, поддерживаемые Whisper

**Пример:**

```python
audio_path = "data/clips/audio_file.mp3"
```

### Выходные данные (Output)

**Тип:** `dict`  
**Описание:** Словарь с результатами транскрибации

**Структура результата:**

```python
{
    'segments': list[dict],     # Список сегментов с временными метками
    'full_text': dict           # Полный результат от Whisper
}
```

**Структура каждого сегмента:**

```python
{
    'start': float,    # Время начала сегмента в секундах
    'end': float,      # Время окончания сегмента в секундах
    'text': str        # Текст сегмента
}
```

**Пример результата:**

```python
{
    'segments': [
        {
            'start': 0.0,
            'end': 2.5,
            'text': 'Привет, как дела?'
        },
        {
            'start': 2.5,
            'end': 5.0,
            'text': 'Спасибо, хорошо.'
        }
    ],
    'full_text': {
        'text': 'Привет, как дела? Спасибо, хорошо.',
        'segments': [...],  # Оригинальные сегменты от Whisper
        'language': 'ru'    # Определенный язык
    }
}
```

### Алгоритм работы

1. **Загрузка модели:** Загружается предобученная модель Whisper "base"
2. **Транскрибация:** Аудиофайл обрабатывается моделью Whisper
3. **Обработка сегментов:** Временные метки и текст извлекаются из каждого сегмента
4. **Форматирование:** Результат приводится к единому формату
5. **Возврат:** Возвращается структурированный результат

### Особенности

- **Многоязычность:** Автоматически определяет язык аудио
- **Сегментация:** Разбивает аудио на временные сегменты
- **Точность:** Использует современную модель Whisper
- **Простота:** Минимальная настройка, работает "из коробки"
- **Скорость:** Баланс между качеством и скоростью обработки

### Модель Whisper

Используется модель **"small"** - оптимальный выбор для большинства задач:

- **Размер:** ~461 МБ
- **Точность:** Хорошая для большинства языков
- **Скорость:** Быстрая обработка
- **Поддержка:** 99+ языков

## Тестирование функции

### Запуск тестов

```bash
python test_whisper_transcriber.py
```

### Что тестирует:

- **Транскрибация русских аудиофайлов**
- **Сравнение с эталонными текстами**
- **Обработка ошибок**
- **Качество сегментации**

### Пример вывода тестов:

```
Загружаем данные валидации...
Найдено 150 записей с аудио и текстом

Тестируем файл 1/3: common_voice_ru_40866662.mp3
Ожидаемый текст: Привет, как дела?
Транскрибированный текст: Привет, как дела?

Тестируем файл 2/3: common_voice_ru_40866663.mp3
Ожидаемый текст: Сегодня хорошая погода.
Транскрибированный текст: Сегодня хорошая погода.
```

### Настройка тестов

Отредактируйте `test_whisper_transcriber.py` для изменения количества тестовых файлов:

```python
test_whisper_transcription(num_samples=5)  # Изменить количество тестов
```

---

**Вход:** `"path/to/audio.mp3"`  
**Выход:** `{"segments": [...], "full_text": {...}}`

**Модель:** Whisper "small"  
**Поддержка:** 99+ языков
