# Highlight Ideas Module

Модуль для выделения и структурирования идей в аудио/видео сегментах на основе временных меток.

## Функции

### 1. `highlight_segments(segments, idea_marks)`

Добавляет цвета идей к сегментам на основе временных меток.

#### Входные данные

**`segments`** - `list[dict]`  
Список сегментов с временными метками

```python
{
    'start': float,      # Время начала сегмента в секундах
    'end': float,        # Время окончания сегмента в секундах
    'text': str          # Текст сегмента
}
```

**`idea_marks`** - `list[dict]`  
Список временных меток идей для выделения

```python
{
    'start_time': float,  # Время начала идеи в секундах
    'end_time': float,    # Время окончания идеи в секундах
    'color': str          # Цвет для выделения
}
```

#### Выходные данные

**`list[dict]`** - Список сегментов с добавленными цветами идей

```python
{
    'start': float,           # Время начала сегмента
    'end': float,             # Время окончания сегмента
    'text': str,              # Текст сегмента
    'idea_colors': list[str]  # Список цветов идей
}
```

### 2. `build_structured_segments(segments, idea_marks)`

Создает структурированные сегменты с иерархическими метками идей.

#### Входные данные

Те же параметры, что и для `highlight_segments`

#### Выходные данные

**`list[dict]`** - Список сегментов с иерархическими метками

```python
{
    'start': float,           # Время начала сегмента
    'end': float,             # Время окончания сегмента
    'text': str,              # Текст сегмента
    'idea_colors': list[str], # Список цветов идей
    'idea_label': str         # Иерархическая метка идеи
}
```

## Примеры использования

### Базовый пример

```python
from highlight_ideas.highlite import highlight_segments, build_structured_segments

segments = [
    {'start': 0.0, 'end': 5.0, 'text': 'Сегмент 1'},
    {'start': 5.0, 'end': 10.0, 'text': 'Сегмент 2'},
    {'start': 10.0, 'end': 15.0, 'text': 'Сегмент 3'},
]

idea_marks = [
    {'start_time': 0.0, 'end_time': 10.0, 'color': 'red'},
    {'start_time': 2.0, 'end_time': 5.0, 'color': 'blue'},
]

# Простое выделение цветами
highlighted = highlight_segments(segments, idea_marks)

# Структурированные сегменты с метками
structured = build_structured_segments(segments, idea_marks)
```

### Сложный пример с вложенными идеями

```python
segments = [
    {'start': 0.0, 'end': 2.0, 'text': 'Начало'},
    {'start': 2.0, 'end': 4.0, 'text': 'Основная идея'},
    {'start': 4.0, 'end': 6.0, 'text': 'Под-идея'},
    {'start': 6.0, 'end': 8.0, 'text': 'Конец'},
]

idea_marks = [
    {'start_time': 0.0, 'end_time': 8.0, 'color': 'red'},      # Основная идея
    {'start_time': 2.0, 'end_time': 6.0, 'color': 'blue'},     # Под-идея
    {'start_time': 4.0, 'end_time': 5.0, 'color': 'green'},    # Деталь
]

result = build_structured_segments(segments, idea_marks)
```

Результат:

```python
[
    {
        'start': 0.0, 'end': 2.0, 'text': 'Начало',
        'idea_colors': ['red'], 'idea_label': 'Идея 1'
    },
    {
        'start': 2.0, 'end': 4.0, 'text': 'Основная идея',
        'idea_colors': ['red', 'blue'], 'idea_label': 'Идея 1.1'
    },
    {
        'start': 4.0, 'end': 6.0, 'text': 'Под-идея',
        'idea_colors': ['red', 'blue', 'green'], 'idea_label': 'Идея 1.1.1'
    },
    {
        'start': 6.0, 'end': 8.0, 'text': 'Конец',
        'idea_colors': ['red', 'blue'], 'idea_label': 'Идея 1.1'
    }
]
```

## Алгоритм работы

### `highlight_segments`

1. Создается копия входных сегментов с пустым списком `idea_colors`
2. Для каждой метки идеи перебираются все сегменты
3. Если сегмент пересекается с диапазоном идеи, добавляется цвет
4. Возвращается список сегментов с цветами

### `build_structured_segments`

1. Вызывает `highlight_segments` для получения цветов
2. Использует `IdeaHierarchy` для создания иерархических меток
3. Отслеживает изменения в цветах и создает нумерованные метки
4. Возвращает структурированные сегменты с метками

## Особенности

- **Пересечение сегментов:** Сегмент подсвечивается при любом пересечении с идеей
- **Множественные цвета:** Один сегмент может содержать несколько цветов
- **Иерархические метки:** Автоматическое создание нумерованных меток типа "Идея 1.2.3"
- **Сохранение данных:** Исходные данные сегментов не изменяются
- **Гибкость цветов:** Поддерживает любые строковые значения для цветов

## Тестирование

Для запуска тестов используйте:

```bash
python tests/test_highlite.py
```

Тесты проверяют:

- Корректность выделения цветов
- Создание иерархических меток
- Работу с вложенными идеями
- Обработку граничных случаев
